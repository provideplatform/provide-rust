version: '3.5'

services:
  postgres:
    image: postgres
    container_name: postgres
    environment:
      - POSTGRES_DB=prvd
      - POSTGRES_USER=prvd
      - POSTGRES_PASSWORD=prvdp455
    healthcheck:
      test: ['CMD', 'pg_isready', '-U', 'prvd', '-d', 'prvd']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: postgres
    volumes:
      - provide-db:/var/lib/postgresql/data
    networks:
      - provide
    ports:
      - 5432:5432
    restart: always
    profiles:
      - core

  redis:
    image: redis
    container_name: redis
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: redis
    networks:
      - provide
    ports:
      - 6379:6379
    restart: always
    profiles:
      - core

  nats:
    image: provide/nats-server:2.7.2-PRVD
    container_name: provide-nats
    command:
      [
        '--js',
        '--server_name',
        'prvd-nats1',
        '-auth',
        'testtoken',
        '-p',
        '4222',
        '-D',
        '-V',
      ]
    environment:
      JWT_SIGNER_PUBLIC_KEY: |-
        -----BEGIN PUBLIC KEY-----
        MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAullT/WoZnxecxKwQFlwE
        9lpQrekSD+txCgtb9T3JvvX/YkZTYkerf0rssQtrwkBlDQtm2cB5mHlRt4lRDKQy
        EA2qNJGM1Yu379abVObQ9ZXI2q7jTBZzL/Yl9AgUKlDIAXYFVfJ8XWVTi0l32Vsx
        tJSd97hiRXO+RqQu5UEr3jJ5tL73iNLp5BitRBwa4KbDCbicWKfSH5hK5DM75EyM
        R/SzR3oCLPFNLs+fyc7zH98S1atglbelkZsMk/mSIKJJl1fZFVCUxA+8CaPiKbpD
        QLpzydqyrk/y275aSU/tFHidoewvtWorNyFWRnefoWOsJFlfq1crgMu2YHTMBVtU
        SJ+4MS5D9fuk0queOqsVUgT7BVRSFHgDH7IpBZ8s9WRrpE6XOE+feTUyyWMjkVgn
        gLm5RSbHpB8Wt/Wssy3VMPV3T5uojPvX+ITmf1utz0y41gU+iZ/YFKeNN8WysLxX
        AP3Bbgo+zNLfpcrH1Y27WGBWPtHtzqiafhdfX6LQ3/zXXlNuruagjUohXaMltH+S
        K8zK4j7n+BYl+7y1dzOQw4CadsDi5whgNcg2QUxuTlW+TQ5VBvdUl9wpTSygD88H
        xH2b0OBcVjYsgRnQ9OZpQ+kIPaFhaWChnfEArCmhrOEgOnhfkr6YGDHFenfT3/RA
        PUl1cxrvY7BHh4obNa6Bf8ECAwEAAQ==
        -----END PUBLIC KEY-----
    healthcheck:
      test: ['CMD', '/usr/local/bin/await_tcp.sh', 'localhost:4222']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: nats
    networks:
      - provide
    ports:
      - 4221:4221
      - 4222:4222
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached
    profiles:
      - core

  ident:
    image: provide/ident
    container_name: ident-api
    depends_on:
      - nats
      - postgres
      - redis
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=ident
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - REDIS_HOSTS=redis:6379
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - IDENT_API_HOST=ident:8080
      - IDENT_API_SCHEME=http
      - VAULT_API_HOST=vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://ident:8080/status']
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 5s
    hostname: ident
    networks:
      - provide
    ports:
      - 8081:8080
    restart: always
    profiles:
      - core

  ident-consumer:
    image: provide/ident
    entrypoint: ./ops/run_consumer.sh
    container_name: ident-consumer
    depends_on:
      - ident
      - nats
      - postgres
      - redis
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=postgres
      - DATABASE_NAME=ident_dev
      - DATABASE_USER=ident
      - DATABASE_PASSWORD=ident
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - NATS_CLIENT_PREFIX=ident-consumer
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - REDIS_HOSTS=redis:6379
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - IDENT_API_HOST=ident:8080
      - IDENT_API_SCHEME=http
      - VAULT_API_HOST=vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://ident:8080/status']
      interval: 1m
      timeout: 5s
      retries: 2
      start_period: 10s
    hostname: ident-consumer
    networks:
      - provide
    restart: always
    profiles:
      - core

  vault:
    image: provide/vault
    entrypoint: ./ops/run_api.sh
    container_name: vault-api
    depends_on:
      - ident
      - postgres
      - redis
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_NAME=vault_dev
      - DATABASE_USER=vault
      - DATABASE_PASSWORD=vault
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - PORT=8080
      - REDIS_HOSTS=redis:6379
      - SEAL_UNSEAL_KEY=traffic charge swing glimpse will citizen push mutual embrace volcano siege identify gossip battle casual exit enrich unlock muscle vast female initial please day
      - SEAL_UNSEAL_VALIDATION_HASH=0x7cff64a2d2b709dd9df196000be6237875bafe0a92873fd9fd9f35c00808f309
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://vault:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: vault
    networks:
      - provide
    ports:
      - 8082:8080
    restart: always
    profiles:
      - core

  privacy:
    image: provide/privacy
    container_name: privacy-api
    depends_on:
      - ident
      - nats
      - postgres
      - privacy-consumer
      - redis
      - vault
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - PORT=8080
      - VAULT_API_HOST=vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://privacy:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy
    networks:
      - provide
    ports:
      - 8083:8080
    restart: always
    profiles:
      - core

  privacy-consumer:
    image: provide/privacy
    entrypoint: ./ops/run_consumer.sh
    container_name: privacy-consumer
    depends_on:
      - nats
      - postgres
      - redis
      - vault
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=postgres
      - DATABASE_NAME=privacy_dev
      - DATABASE_USER=privacy
      - DATABASE_PASSWORD=privacy
      - DATABASE_SUPERUSER=prvd
      - DATABASE_SUPERUSER_PASSWORD=prvdp455
      - IDENT_API_HOST=ident:8080
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=privacy-consumer
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - VAULT_API_HOST=vault:8080
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://privacy:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: privacy-consumer
    networks:
      - provide
    restart: always
    profiles:
      - core

  nchain:
    image: provide/nchain
    entrypoint: ./ops/run_api.sh
    container_name: nchain-api
    depends_on:
      - ident
      - nats
      - postgres
      - redis
      - vault
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_NAME=nchain_dev
      - DATABASE_USER=nchain
      - DATABASE_PASSWORD=nchain
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=nchain
      - NATS_CLUSTER_ID=provide
      - NATS_TOKEN=testtoken
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - PORT=8080
      - REDIS_HOSTS=redis:6379
      - IDENT_API_HOST=ident:8080
      - IDENT_API_PATH=api/v1
      - IDENT_API_SCHEME=http
      - PAYMENTS_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6ImU2OmY3OmQ1OjI0OmUyOjU5OjA2OjJiOmJjOmEyOjhjOjM1OjlkOmNhOjBhOjg3IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA0NTA5MjI5LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiIwN2E0YTc1Ny04YWE4LTRjMjgtOTEzZS1jMDE2ZDU5N2FiNTgiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4wYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJuZXR3b3JrLiouY29ubmVjdG9yLioiLCJuZXR3b3JrLiouc3RhdHVzIiwicGxhdGZvcm0uXHUwMDNlIl19fX0sInBydmQiOnsiYXBwbGljYXRpb25faWQiOiIwYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJleHRlbmRlZCI6eyJwZXJtaXNzaW9ucyI6eyIqIjo1MTB9fSwicGVybWlzc2lvbnMiOjUxMH0sInN1YiI6ImFwcGxpY2F0aW9uOjBjNWE5ZmViLTE2MGMtNGZlMS05MTBlLTE4NzQyZjg2NGJjZSJ9.wP8HKOGXUkwUqn_GBnbT6qkSQQOk5VagBdCagPCoZM-SMI5OocfqbSf-xeJT9KcfYGGUFeBbkD61rcSvzsVfiYNgHZuq0Bj3T4BvXx-bDIgNL76pE8iy1xLpy7kkuyRmSogjT3dDxJG5E-a39lpIOwGdOkjjY5mvaVRQe5m6ijLPRZ2EooC6mlov583xGzsTNV6pMat7ddpqDyxclSXhc_XSzL03tX6D4Z1xuSAfjY3ZfJWHaY2duvr-Xe_BfrbHWy2C8zrTb0zEx3J-z5wUQj660L-mQ83ShLbR7eOwVOQCiMHzqy1GeBq1rZH18-mS6iis3vIXNpxxTy69W9gshiABeyG8tqBnvfH0SkycT-CQcGvrXkcgEjilrDYCRxVk-iACMwp0-G-GWabqzgXTa2QN8eMC3rNwFm2rz3lnlUSDnehp203wzqmqKkltgrDVpGoucZJsiS_cWGUTN3bvyXmdcrYzFrWRHkyuyVdbSjg1FDENEZ5DtOgln_gW5Pd6LlwPVgtvNYVQeKAc5iu1NiCnD4agXEGrTc5zxzxq2687EbFMI9Vf8nEcOQQ3haSi9wLOOpr2f6HjtDa_5HFf1n_yKnNPgQxpC9-70fxyavMOvKHRRhIAFu7o08XPe-DSBBIvjez7tvgrVxbSDXStdVGSxm40yAveCzoAkFxal4g
      - VAULT_API_HOST=vault:8080
      - VAULT_API_PATH=api/v1
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - REQUEST_TIMEOUT=20
      - RPC_TIMEOUT=10
      - EVM_SYNC_TIMEOUT=10
      - ENABLED_L1_NETWORK_IDS=ffc9a168-1327-4ddc-8af9-2301da82cccb
      - ENABLED_L2_NETWORK_IDS=4251b6fd-c98d-4017-87a3-d691a77a52a7
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://nchain:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: nchain
    networks:
      - provide
    ports:
      - 8084:8080
    restart: always
    profiles:
      - core

  nchain-consumer:
    image: provide/nchain
    entrypoint: ./ops/run_consumer.sh
    container_name: nchain-consumer
    depends_on:
      - nats
      - postgres
      - redis
      - vault
    environment:
      - CONSUME_NATS_STREAMING_SUBSCRIPTIONS=true
      - DATABASE_HOST=postgres
      - DATABASE_NAME=nchain_dev
      - DATABASE_USER=nchain
      - DATABASE_PASSWORD=nchain
      - LOG_LEVEL=DEBUG
      - NATS_CLUSTER_ID=provide
      - NATS_CLIENT_PREFIX=nchain-consumer
      - NATS_URL=nats://nats:4222
      - NATS_JETSTREAM_URL=nats://nats:4222
      - NATS_TOKEN=testtoken
      - REDIS_HOSTS=redis:6379
      - IDENT_API_HOST=ident:8080
      - IDENT_API_PATH=api/v1
      - IDENT_API_SCHEME=http
      - VAULT_API_HOST=vault:8080
      - VAULT_API_PATH=api/v1
      - VAULT_API_SCHEME=http
      - PAYMENTS_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6ImU2OmY3OmQ1OjI0OmUyOjU5OjA2OjJiOmJjOmEyOjhjOjM1OjlkOmNhOjBhOjg3IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA0NTA5MjI5LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiIwN2E0YTc1Ny04YWE4LTRjMjgtOTEzZS1jMDE2ZDU5N2FiNTgiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4wYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJuZXR3b3JrLiouY29ubmVjdG9yLioiLCJuZXR3b3JrLiouc3RhdHVzIiwicGxhdGZvcm0uXHUwMDNlIl19fX0sInBydmQiOnsiYXBwbGljYXRpb25faWQiOiIwYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJleHRlbmRlZCI6eyJwZXJtaXNzaW9ucyI6eyIqIjo1MTB9fSwicGVybWlzc2lvbnMiOjUxMH0sInN1YiI6ImFwcGxpY2F0aW9uOjBjNWE5ZmViLTE2MGMtNGZlMS05MTBlLTE4NzQyZjg2NGJjZSJ9.wP8HKOGXUkwUqn_GBnbT6qkSQQOk5VagBdCagPCoZM-SMI5OocfqbSf-xeJT9KcfYGGUFeBbkD61rcSvzsVfiYNgHZuq0Bj3T4BvXx-bDIgNL76pE8iy1xLpy7kkuyRmSogjT3dDxJG5E-a39lpIOwGdOkjjY5mvaVRQe5m6ijLPRZ2EooC6mlov583xGzsTNV6pMat7ddpqDyxclSXhc_XSzL03tX6D4Z1xuSAfjY3ZfJWHaY2duvr-Xe_BfrbHWy2C8zrTb0zEx3J-z5wUQj660L-mQ83ShLbR7eOwVOQCiMHzqy1GeBq1rZH18-mS6iis3vIXNpxxTy69W9gshiABeyG8tqBnvfH0SkycT-CQcGvrXkcgEjilrDYCRxVk-iACMwp0-G-GWabqzgXTa2QN8eMC3rNwFm2rz3lnlUSDnehp203wzqmqKkltgrDVpGoucZJsiS_cWGUTN3bvyXmdcrYzFrWRHkyuyVdbSjg1FDENEZ5DtOgln_gW5Pd6LlwPVgtvNYVQeKAc5iu1NiCnD4agXEGrTc5zxzxq2687EbFMI9Vf8nEcOQQ3haSi9wLOOpr2f6HjtDa_5HFf1n_yKnNPgQxpC9-70fxyavMOvKHRRhIAFu7o08XPe-DSBBIvjez7tvgrVxbSDXStdVGSxm40yAveCzoAkFxal4g
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - REQUEST_TIMEOUT=20
      - RPC_TIMEOUT=10
      - EVM_SYNC_TIMEOUT=10
      - ENABLED_L1_NETWORK_IDS=ffc9a168-1327-4ddc-8af9-2301da82cccb
      - ENABLED_L2_NETWORK_IDS=4251b6fd-c98d-4017-87a3-d691a77a52a7
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://nchain-consumer:8080/status'] # FIXME
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: nchain-consumer
    networks:
      - provide
    ports:
      - 8087:8080
    restart: always
    profiles:
      - core

  statsdaemon:
    image: provide/nchain
    entrypoint: ./ops/run_statsdaemon.sh
    container_name: statsdaemon
    depends_on:
      - nats
      - postgres
      - redis
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_NAME=nchain_dev
      - DATABASE_USER=nchain
      - DATABASE_PASSWORD=nchain
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=statsdaemon
      - NATS_URL=nats://nats:4222
      - NATS_CLUSTER_ID=provide
      - NATS_JETSTREAM_URL=nats://nats:4222
      - REDIS_HOSTS=redis:6379
      - IDENT_API_HOST=ident:8080
      - IDENT_API_PATH=api/v1
      - IDENT_API_SCHEME=http
      - VAULT_API_HOST=vault:8080
      - VAULT_API_PATH=api/v1
      - VAULT_API_SCHEME=http
      - PAYMENTS_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6ImU2OmY3OmQ1OjI0OmUyOjU5OjA2OjJiOmJjOmEyOjhjOjM1OjlkOmNhOjBhOjg3IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA0NTA5MjI5LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiIwN2E0YTc1Ny04YWE4LTRjMjgtOTEzZS1jMDE2ZDU5N2FiNTgiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4wYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJuZXR3b3JrLiouY29ubmVjdG9yLioiLCJuZXR3b3JrLiouc3RhdHVzIiwicGxhdGZvcm0uXHUwMDNlIl19fX0sInBydmQiOnsiYXBwbGljYXRpb25faWQiOiIwYzVhOWZlYi0xNjBjLTRmZTEtOTEwZS0xODc0MmY4NjRiY2UiLCJleHRlbmRlZCI6eyJwZXJtaXNzaW9ucyI6eyIqIjo1MTB9fSwicGVybWlzc2lvbnMiOjUxMH0sInN1YiI6ImFwcGxpY2F0aW9uOjBjNWE5ZmViLTE2MGMtNGZlMS05MTBlLTE4NzQyZjg2NGJjZSJ9.wP8HKOGXUkwUqn_GBnbT6qkSQQOk5VagBdCagPCoZM-SMI5OocfqbSf-xeJT9KcfYGGUFeBbkD61rcSvzsVfiYNgHZuq0Bj3T4BvXx-bDIgNL76pE8iy1xLpy7kkuyRmSogjT3dDxJG5E-a39lpIOwGdOkjjY5mvaVRQe5m6ijLPRZ2EooC6mlov583xGzsTNV6pMat7ddpqDyxclSXhc_XSzL03tX6D4Z1xuSAfjY3ZfJWHaY2duvr-Xe_BfrbHWy2C8zrTb0zEx3J-z5wUQj660L-mQ83ShLbR7eOwVOQCiMHzqy1GeBq1rZH18-mS6iis3vIXNpxxTy69W9gshiABeyG8tqBnvfH0SkycT-CQcGvrXkcgEjilrDYCRxVk-iACMwp0-G-GWabqzgXTa2QN8eMC3rNwFm2rz3lnlUSDnehp203wzqmqKkltgrDVpGoucZJsiS_cWGUTN3bvyXmdcrYzFrWRHkyuyVdbSjg1FDENEZ5DtOgln_gW5Pd6LlwPVgtvNYVQeKAc5iu1NiCnD4agXEGrTc5zxzxq2687EbFMI9Vf8nEcOQQ3haSi9wLOOpr2f6HjtDa_5HFf1n_yKnNPgQxpC9-70fxyavMOvKHRRhIAFu7o08XPe-DSBBIvjez7tvgrVxbSDXStdVGSxm40yAveCzoAkFxal4g
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - REQUEST_TIMEOUT=20
      - RPC_TIMEOUT=10
      - EVM_SYNC_TIMEOUT=10
      - ENABLED_L1_NETWORK_IDS=ffc9a168-1327-4ddc-8af9-2301da82cccb
      - ENABLED_L2_NETWORK_IDS=4251b6fd-c98d-4017-87a3-d691a77a52a7
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://statsdaemon:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: statsdaemon
    networks:
      - provide
    restart: always
    profiles:
      - core

  baseline-postgres-1:
    image: postgres
    container_name: baseline-postgres-1
    environment:
      - POSTGRES_DB=prvd
      - POSTGRES_USER=prvd
      - POSTGRES_PASSWORD=prvdp455
    healthcheck:
      test: ['CMD', 'pg_isready', '-U', 'prvd', '-d', 'prvd']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-postgres-1
    volumes:
      - prvd-bpi-1-db:/var/lib/postgresql/data
    networks:
      - prvd-bpi-1
    ports:
      - 5433:5432
    restart: always
    profiles:
      - bpi-1

  baseline-redis-1:
    image: redis
    container_name: baseline-redis-1
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-redis-1
    networks:
      - prvd-bpi-1
    ports:
      - 6380:6379
    restart: always
    profiles:
      - bpi-1

  baseline-nats-1:
    image: provide/nats-server:2.7.2-PRVD
    container_name: baseline-nats-1
    command:
      [
        '--js',
        '--server_name',
        'prvd-nats1',
        '-auth',
        'testtoken',
        '-p',
        '4224',
        '-D',
        '-V',
      ]
    environment:
      JWT_SIGNER_PUBLIC_KEY: |-
        -----BEGIN PUBLIC KEY-----
        MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAullT/WoZnxecxKwQFlwE
        9lpQrekSD+txCgtb9T3JvvX/YkZTYkerf0rssQtrwkBlDQtm2cB5mHlRt4lRDKQy
        EA2qNJGM1Yu379abVObQ9ZXI2q7jTBZzL/Yl9AgUKlDIAXYFVfJ8XWVTi0l32Vsx
        tJSd97hiRXO+RqQu5UEr3jJ5tL73iNLp5BitRBwa4KbDCbicWKfSH5hK5DM75EyM
        R/SzR3oCLPFNLs+fyc7zH98S1atglbelkZsMk/mSIKJJl1fZFVCUxA+8CaPiKbpD
        QLpzydqyrk/y275aSU/tFHidoewvtWorNyFWRnefoWOsJFlfq1crgMu2YHTMBVtU
        SJ+4MS5D9fuk0queOqsVUgT7BVRSFHgDH7IpBZ8s9WRrpE6XOE+feTUyyWMjkVgn
        gLm5RSbHpB8Wt/Wssy3VMPV3T5uojPvX+ITmf1utz0y41gU+iZ/YFKeNN8WysLxX
        AP3Bbgo+zNLfpcrH1Y27WGBWPtHtzqiafhdfX6LQ3/zXXlNuruagjUohXaMltH+S
        K8zK4j7n+BYl+7y1dzOQw4CadsDi5whgNcg2QUxuTlW+TQ5VBvdUl9wpTSygD88H
        xH2b0OBcVjYsgRnQ9OZpQ+kIPaFhaWChnfEArCmhrOEgOnhfkr6YGDHFenfT3/RA
        PUl1cxrvY7BHh4obNa6Bf8ECAwEAAQ==
        -----END PUBLIC KEY-----
    healthcheck:
      test: ['CMD', '/usr/local/bin/await_tcp.sh', 'localhost:4224']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-nats-1
    networks:
      - prvd-bpi-1
    ports:
      - 4223:4223
      - 4224:4224
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached
    profiles:
      - bpi-1

  baseline-elasticsearch-1:
    image: elasticsearch:8.3.3
    container_name: baseline-elasticsearch-1
    environment:
      - ELASTIC_PASSWORD=3l4s71c
    healthcheck:
      test: ['CMD', 'nc', '-zv', 'prvd-elasticsearch', '9200']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-elasticsearch-1
    networks:
      - prvd-bpi-1
    ports:
      - 9200:9200
      - 9300:9300
    restart: always
    profiles:
      - bpi-1

  baseline-api-1:
    image: provide/baseline
    entrypoint: ./ops/run_api.sh
    container_name: baseline-api-1
    depends_on:
      - baseline-nats-1
      - baseline-postgres-1
      - baseline-redis-1
    environment:
      - BASELINE_ORGANIZATION_ADDRESS=
      - BASELINE_REGISTRY_CONTRACT_ADDRESS=
      - DATABASE_HOST=baseline-postgres-1
      - DATABASE_NAME=baseline_dev
      - DATABASE_USER=baseline
      - DATABASE_PASSWORD=baseline
      - IDENT_API_HOST=host.docker.internal:8081
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=baseline
      - NATS_URL=nats://baseline-nats-1:4224
      - NATS_JETSTREAM_URL=nats://baseline-nats-1:4224
      - NCHAIN_API_HOST=host.docker.internal:8084
      - NCHAIN_API_SCHEME=http
      - NCHAIN_BASELINE_NETWORK_ID=
      - PRIVACY_API_HOST=host.docker.internal:8083
      - PRIVACY_API_SCHEME=http
      - PROVIDE_ORGANIZATION_ID=
      - PROVIDE_ORGANIZATION_REFRESH_TOKEN=
      - BASELINE_WORKGROUP_ID=
      - PROVIDE_SOR_IDENTIFIER=ephemeral
      - PROVIDE_SOR_URL=
      - REDIS_HOSTS=baseline-redis-1:6379
      - VAULT_API_HOST=host.docker.internal:8082
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - BASELINE_ORGANIZATION_MESSAGING_ENDPOINT=nats://baseline-nats-1:4223
      - BASELINE_ORGANIZATION_PROXY_ENDPOINT=http://prvd-bpi-1:8080
      - ELASTICSEARCH_HOSTS=baseline-elasticsearch-1:9200
      - ELASTICSEARCH_ACCEPT_SELF_SIGNED_CERTIFICATE=true
      - ELASTICSEARCH_API_SCHEME=https
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=3l4s71c
      - SERVICENOW_LIST_SCHEMAS_API_PATH=api/x_prot9_provide/setup_configuration/ListSchemas
      - SERVICENOW_SCHEMA_DETAILS_API_PATH=api/x_prot9_provide/setup_configuration/GetSchemaDetails
      - SERVICENOW_HEALTHCHECK_API_PATH=api/now/branding
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://prvd-bpi-1:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: prvd-bpi-1
    networks:
      - prvd-bpi-1
    ports:
      - 8085:8080
    restart: always
    profiles:
      - bpi-1

  baseline-consumer-1:
    image: provide/baseline
    entrypoint: ./ops/run_consumer.sh
    container_name: baseline-consumer-1
    depends_on:
      - baseline-nats-1
      - baseline-postgres-1
      - baseline-redis-1
    environment:
      - BASELINE_ORGANIZATION_ADDRESS=
      - BASELINE_REGISTRY_CONTRACT_ADDRESS=
      - DATABASE_HOST=baseline-postgres-1
      - DATABASE_NAME=baseline_dev
      - DATABASE_USER=baseline
      - DATABASE_PASSWORD=baseline
      - IDENT_API_HOST=host.docker.internal:8081
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=baseline
      - NATS_URL=nats://baseline-nats-1:4224
      - NATS_JETSTREAM_URL=nats://baseline-nats-1:4224
      - NCHAIN_API_HOST=host.docker.internal:8084
      - NCHAIN_API_SCHEME=http
      - NCHAIN_BASELINE_NETWORK_ID=
      - PRIVACY_API_HOST=host.docker.internal:8083
      - PRIVACY_API_SCHEME=http
      - PROVIDE_ORGANIZATION_ID=
      - PROVIDE_ORGANIZATION_REFRESH_TOKEN=
      - BASELINE_WORKGROUP_ID=
      - PROVIDE_SOR_IDENTIFIER=ephemeral
      - PROVIDE_SOR_URL=
      - REDIS_HOSTS=baseline-redis-1:6379
      - VAULT_API_HOST=host.docker.internal:8082
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - BASELINE_ORGANIZATION_MESSAGING_ENDPOINT=nats://baseline-nats-1:4223
      - BASELINE_ORGANIZATION_PROXY_ENDPOINT=http://prvd-bpi-1:8080
      - BASELINE_API_SCHEME=http
      - BASELINE_API_HOST=prvd-bpi-1:8080
      - BASELINE_API_PATH=api/v1
      - ELASTICSEARCH_HOSTS=baseline-elasticsearch-1:9200
      - ELASTICSEARCH_ACCEPT_SELF_SIGNED_CERTIFICATE=true
      - ELASTICSEARCH_API_SCHEME=https
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=3l4s71c
      - SERVICENOW_LIST_SCHEMAS_API_PATH=api/x_prot9_provide/setup_configuration/ListSchemas
      - SERVICENOW_SCHEMA_DETAILS_API_PATH=api/x_prot9_provide/setup_configuration/GetSchemaDetails
      - SERVICENOW_HEALTHCHECK_API_PATH=api/now/branding
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://prvd-bpi-1:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: prvd-bpi-1-consumer
    networks:
      - prvd-bpi-1
    restart: always
    profiles:
      - bpi-1

  baseline-postgres-2:
    image: postgres
    container_name: baseline-postgres-2
    environment:
      - POSTGRES_DB=prvd
      - POSTGRES_USER=prvd
      - POSTGRES_PASSWORD=prvdp455
    healthcheck:
      test: ['CMD', 'pg_isready', '-U', 'prvd', '-d', 'prvd']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-postgres-2
    volumes:
      - prvd-bpi-2-db:/var/lib/postgresql/data
    networks:
      - prvd-bpi-2
    ports:
      - 5434:5432
    restart: always
    profiles:
      - bpi-2

  baseline-redis-2:
    image: redis
    container_name: baseline-redis-2
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-redis-2
    networks:
      - prvd-bpi-2
    ports:
      - 6381:6379
    restart: always
    profiles:
      - bpi-2

  baseline-nats-2:
    image: provide/nats-server:2.7.2-PRVD
    container_name: baseline-nats-2
    command:
      [
        '--js',
        '--server_name',
        'prvd-nats1',
        '-auth',
        'testtoken',
        '-p',
        '4226',
        '-D',
        '-V',
      ]
    environment:
      JWT_SIGNER_PUBLIC_KEY: |-
        -----BEGIN PUBLIC KEY-----
        MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAullT/WoZnxecxKwQFlwE
        9lpQrekSD+txCgtb9T3JvvX/YkZTYkerf0rssQtrwkBlDQtm2cB5mHlRt4lRDKQy
        EA2qNJGM1Yu379abVObQ9ZXI2q7jTBZzL/Yl9AgUKlDIAXYFVfJ8XWVTi0l32Vsx
        tJSd97hiRXO+RqQu5UEr3jJ5tL73iNLp5BitRBwa4KbDCbicWKfSH5hK5DM75EyM
        R/SzR3oCLPFNLs+fyc7zH98S1atglbelkZsMk/mSIKJJl1fZFVCUxA+8CaPiKbpD
        QLpzydqyrk/y275aSU/tFHidoewvtWorNyFWRnefoWOsJFlfq1crgMu2YHTMBVtU
        SJ+4MS5D9fuk0queOqsVUgT7BVRSFHgDH7IpBZ8s9WRrpE6XOE+feTUyyWMjkVgn
        gLm5RSbHpB8Wt/Wssy3VMPV3T5uojPvX+ITmf1utz0y41gU+iZ/YFKeNN8WysLxX
        AP3Bbgo+zNLfpcrH1Y27WGBWPtHtzqiafhdfX6LQ3/zXXlNuruagjUohXaMltH+S
        K8zK4j7n+BYl+7y1dzOQw4CadsDi5whgNcg2QUxuTlW+TQ5VBvdUl9wpTSygD88H
        xH2b0OBcVjYsgRnQ9OZpQ+kIPaFhaWChnfEArCmhrOEgOnhfkr6YGDHFenfT3/RA
        PUl1cxrvY7BHh4obNa6Bf8ECAwEAAQ==
        -----END PUBLIC KEY-----
    healthcheck:
      test: ['CMD', '/usr/local/bin/await_tcp.sh', 'localhost:4226']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: baseline-nats-2
    networks:
      - prvd-bpi-2
    ports:
      - 4225:4225
      - 4226:4226
    restart: always
    volumes:
      - ./ops/await_tcp.sh:/usr/local/bin/await_tcp.sh:cached
    profiles:
      - bpi-2

  # FIXME-- this baseline-elasticsearch-2 conflicts with baseline-elasticsearch-1 and causes both to fail when started
  # baseline-elasticsearch-2:
  #   image: elasticsearch:8.3.3
  #   container_name: baseline-elasticsearch-2
  #   environment:
  #     - ELASTIC_PASSWORD=3l4s71c
  #     - ES_PORT=9201
  #   healthcheck:
  #     test: ['CMD', 'nc', '-zv', 'baseline-elasticsearch-2', '9200']
  #     interval: 1m
  #     timeout: 1s
  #     retries: 2
  #     start_period: 10s
  #   hostname: baseline-elasticsearch-2
  #   networks:
  #     - prvd-bpi-2
  #   ports:
  #     - 9201:9200
  #     - 9301:9300
  #   restart: always
  #   profiles:
  #     - bpi-2

  baseline-api-2:
    image: provide/baseline
    entrypoint: ./ops/run_api.sh
    container_name: baseline-api-2
    depends_on:
      - baseline-nats-2
      - baseline-postgres-2
      - baseline-redis-2
    environment:
      - BASELINE_ORGANIZATION_ADDRESS=
      - BASELINE_REGISTRY_CONTRACT_ADDRESS=
      - DATABASE_HOST=baseline-postgres-2
      - DATABASE_NAME=baseline_dev
      - DATABASE_USER=baseline
      - DATABASE_PASSWORD=baseline
      - IDENT_API_HOST=host.docker.internal:8081
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=baseline
      - NATS_URL=nats://baseline-nats-2:4226
      - NATS_JETSTREAM_URL=nats://baseline-nats-2:4226
      - NCHAIN_API_HOST=host.docker.internal:8084
      - NCHAIN_API_SCHEME=http
      - NCHAIN_BASELINE_NETWORK_ID=
      - PRIVACY_API_HOST=host.docker.internal:8083
      - PRIVACY_API_SCHEME=http
      - PROVIDE_ORGANIZATION_ID=
      - PROVIDE_ORGANIZATION_REFRESH_TOKEN=
      - BASELINE_WORKGROUP_ID=
      - PROVIDE_SOR_IDENTIFIER=ephemeral
      - PROVIDE_SOR_URL=
      - REDIS_HOSTS=baseline-redis-2:6379
      - VAULT_API_HOST=host.docker.internal:8082
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - BASELINE_ORGANIZATION_MESSAGING_ENDPOINT=nats://baseline-nats-2:4225
      - BASELINE_ORGANIZATION_PROXY_ENDPOINT=http://prvd-bpi-2:8080
      - ELASTICSEARCH_HOSTS=host.docker.internal:9200 # FIXME-- should be baseline-elasticsearch-2:9200
      - ELASTICSEARCH_ACCEPT_SELF_SIGNED_CERTIFICATE=true
      - ELASTICSEARCH_API_SCHEME=https
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=3l4s71c
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://prvd-bpi-2:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: prvd-bpi-2
    networks:
      - prvd-bpi-2
    ports:
      - 8086:8080
    restart: always
    profiles:
      - bpi-2

  baseline-consumer-2:
    image: provide/baseline
    entrypoint: ./ops/run_consumer.sh
    container_name: baseline-consumer-2
    depends_on:
      - baseline-nats-2
      - baseline-postgres-2
      - baseline-redis-2
    environment:
      - BASELINE_ORGANIZATION_ADDRESS=
      - BASELINE_REGISTRY_CONTRACT_ADDRESS=
      - DATABASE_HOST=baseline-postgres-2
      - DATABASE_NAME=baseline_dev
      - DATABASE_USER=baseline
      - DATABASE_PASSWORD=baseline
      - IDENT_API_HOST=host.docker.internal:8081
      - IDENT_API_SCHEME=http
      - LOG_LEVEL=DEBUG
      - NATS_CLIENT_PREFIX=baseline
      - NATS_URL=nats://baseline-nats-2:4226
      - NATS_JETSTREAM_URL=nats://baseline-nats-2:4226
      - NCHAIN_API_HOST=host.docker.internal:8084
      - NCHAIN_API_SCHEME=http
      - NCHAIN_BASELINE_NETWORK_ID=
      - PRIVACY_API_HOST=host.docker.internal:8083
      - PRIVACY_API_SCHEME=http
      - PROVIDE_ORGANIZATION_ID=
      - PROVIDE_ORGANIZATION_REFRESH_TOKEN=
      - BASELINE_WORKGROUP_ID=
      - PROVIDE_SOR_IDENTIFIER=ephemeral
      - PROVIDE_SOR_URL=
      - REDIS_HOSTS=baseline-redis-2:6379
      - VAULT_API_HOST=host.docker.internal:8082
      - VAULT_API_SCHEME=http
      - VAULT_REFRESH_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IjEwOjJlOmQ5OmUxOmI4OmEyOjM0OjM3Ojk5OjNhOjI0OmZjOmFhOmQxOmM4OjU5IiwidHlwIjoiSldUIn0.eyJhdWQiOiJodHRwczovL3Byb3ZpZGUuc2VydmljZXMvYXBpL3YxIiwiaWF0IjoxNjA1NzkxMjQ4LCJpc3MiOiJodHRwczovL2lkZW50LnByb3ZpZGUuc2VydmljZXMiLCJqdGkiOiI5YjUxNGIxNS01NTdlLTRhYWQtYTcwOC0wMTcwZTAwZWE1ZmIiLCJuYXRzIjp7InBlcm1pc3Npb25zIjp7InN1YnNjcmliZSI6eyJhbGxvdyI6WyJhcHBsaWNhdGlvbi4zNjAxNTdmOC1kNWExLTQ0NDAtOTE4Yi1mNjhiYjM5YzBkODAiLCJ1c2VyLjIzY2MwN2UwLTM4NTEtNDBkZC1iNjc1LWRmNzY4MDY3MmY3ZCIsIm5ldHdvcmsuKi5jb25uZWN0b3IuKiIsIm5ldHdvcmsuKi5zdGF0dXMiLCJwbGF0Zm9ybS5cdTAwM2UiXX19fSwicHJ2ZCI6eyJhcHBsaWNhdGlvbl9pZCI6IjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCIsImV4dGVuZGVkIjp7InBlcm1pc3Npb25zIjp7IioiOjUxMH19LCJwZXJtaXNzaW9ucyI6NTEwLCJ1c2VyX2lkIjoiMjNjYzA3ZTAtMzg1MS00MGRkLWI2NzUtZGY3NjgwNjcyZjdkIn0sInN1YiI6ImFwcGxpY2F0aW9uOjM2MDE1N2Y4LWQ1YTEtNDQ0MC05MThiLWY2OGJiMzljMGQ4MCJ9.SUh84MKBNstdu3KFu1zEAQq03xbPw1D0lLXeogz1HfBJy77bIGf7HLvCuc6bjkh0xj3cEuEus1dC1Dj3BvlZoSXsvz_biTzSapkXzJjpkwOL6qkYDmqTPZvXwqmk-mUNrHTPkqdiIJL7xA46tzHW3E_hjSA9HjEk1kXjPdJQ6_ifkgWNoAaSD--kudIrhZ7vLnfy0H1JEAOsXzSAMoc5_pNG2n79m0ywvb_4l9BqdsHW8N3xSQOFjcp9gD_tqo6ffug3pkpoy-RSguM_OaMR2lj_CHhYxAt0phtjUceDD3K1h5iZ38kSl7izhOdULMmGBhVpBMoSy6_R6ZzpCL3pj8FcReX9RXR5oYpm8PDtlmWqblQzjwY00-uYLfOX0_iS4MGfEsjadZPfTmJLcOTYC7H4PL9ZRu_XtMDUrGBQQz5b_ad2ZzMXbBNeU6vbxVKDG8VFKWOHAemqHTcvuOAsOCLIqOu-eJpZHlXbx-FXPTYledd-GBDe7IjaC9ll_JK3utCOnCq0qUs6lnXIrQ_Sp1LcTKJJ7aY5f9TxeoAuL-ghDbQ3Xkw6huKyPCz2evOwVLwrB9ZRMlQXgmTnB1OeQvWii1WbmkyV1Zhbz_RPB8ckK7_mFxuPvsXK8wTFiWFmj96sRX470kV-ooSfM5CzKZhSLqgyyaUNC0VaCPq0uuE
      - BASELINE_ORGANIZATION_MESSAGING_ENDPOINT=nats://baseline-nats-2:4225
      - BASELINE_ORGANIZATION_PROXY_ENDPOINT=http://prvd-bpi-2:8080
      - BASELINE_API_SCHEME=http
      - BASELINE_API_HOST=prvd-bpi-2:8080
      - BASELINE_API_PATH=api/v1
      - ELASTICSEARCH_HOSTS=host.docker.internal:9200 # FIXME-- should be baseline-elasticsearch-2:9200
      - ELASTICSEARCH_ACCEPT_SELF_SIGNED_CERTIFICATE=true
      - ELASTICSEARCH_API_SCHEME=https
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=3l4s71c
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://prvd-bpi-2:8080/status']
      interval: 1m
      timeout: 1s
      retries: 2
      start_period: 10s
    hostname: prvd-bpi-2-consumer
    networks:
      - prvd-bpi-2
    restart: always
    profiles:
      - bpi-2

networks:
  provide:
    driver: bridge
    ipam:
      config:
        - subnet: 172.40.0.0/24
  prvd-bpi-1:
    driver: bridge
  prvd-bpi-2:
    driver: bridge

volumes:
  provide-db:
  prvd-bpi-1-db:
  prvd-bpi-2-db:
